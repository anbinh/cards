(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

require('./services');
require('./filters');
require('./directives');
require('./controllers');

// app.js
angular.module('app', [
    'ht.services',
    'ht.directives',
    'ht.filters',
    'ht.controllers',
    'ht.templates',
    'ngRoute',
    'ngResource',
    'angular-storage',
    'oitozero.ngSweetAlert',
    'ui.bootstrap',
    'nouislider',
    'credit-cards'
]);
},{"./controllers":2,"./directives":46,"./filters":48,"./services":52}],2:[function(require,module,exports){
'use strict';
var m = angular.module('ht.controllers', []);


// controllers
require('./lib/home')(m);
require('./lib/store-list')(m);
require('./lib/sell-cards')(m);
require('./lib/sell-cards-card-info')(m);
require('./lib/sell-cards-customer-info')(m);
require('./lib/sell-cards-receipt')(m);

require('./lib/checkout')(m);
require('./lib/review_order')(m);
require('./lib/login')(m);
require('./lib/register')(m);
require('./lib/profile')(m);
require('./lib/profile-edit')(m);
require('./lib/profile-order-list')(m);
require('./lib/profile-order-detail')(m);
require('./lib/profile-sold-cards-list')(m);
require('./lib/profile-sold-cards-details')(m);
require('./lib/forget-password')(m);
require('./lib/reset-password')(m);
require('./lib/shopping-cart')(m);
require('./lib/store-detail')(m);
require('./lib/header')(m);

require('./lib/admin/index')(m);
require('./lib/admin/users')(m);
require('./lib/admin/guests')(m);
require('./lib/admin/dealers')(m);
require('./lib/admin/inventory')(m);
require('./lib/admin/inventory-retailer')(m);
require('./lib/admin/orders')(m);
require('./lib/admin/receipts')(m);
require('./lib/admin/sidebar')(m);
require('./lib/admin/order-detail')(m);
require('./lib/admin/receipt-detail')(m);
require('./lib/admin/login')(m);
require('./lib/admin/head')(m);
require('./lib/admin/cards')(m);
require('./lib/admin/sold_cards')(m);
require('./lib/admin/user-profile')(m);
require('./lib/admin/dealer-profile')(m);
require('./lib/admin/retailer-limit')(m);
require('./lib/admin/pending_cards')(m);
require('./lib/admin/settings')(m);
require('./lib/admin/transactions')(m);
require('./lib/admin/transaction-detail')(m);

module.exports = m;
},{"./lib/admin/cards":3,"./lib/admin/dealer-profile":4,"./lib/admin/dealers":5,"./lib/admin/guests":6,"./lib/admin/head":7,"./lib/admin/index":8,"./lib/admin/inventory":10,"./lib/admin/inventory-retailer":9,"./lib/admin/login":11,"./lib/admin/order-detail":12,"./lib/admin/orders":13,"./lib/admin/pending_cards":14,"./lib/admin/receipt-detail":15,"./lib/admin/receipts":16,"./lib/admin/retailer-limit":17,"./lib/admin/settings":18,"./lib/admin/sidebar":19,"./lib/admin/sold_cards":20,"./lib/admin/transaction-detail":21,"./lib/admin/transactions":22,"./lib/admin/user-profile":23,"./lib/admin/users":24,"./lib/checkout":25,"./lib/forget-password":26,"./lib/header":27,"./lib/home":28,"./lib/login":29,"./lib/profile":35,"./lib/profile-edit":30,"./lib/profile-order-detail":31,"./lib/profile-order-list":32,"./lib/profile-sold-cards-details":33,"./lib/profile-sold-cards-list":34,"./lib/register":36,"./lib/reset-password":37,"./lib/review_order":38,"./lib/sell-cards":42,"./lib/sell-cards-card-info":39,"./lib/sell-cards-customer-info":40,"./lib/sell-cards-receipt":41,"./lib/shopping-cart":43,"./lib/store-detail":44,"./lib/store-list":45}],3:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('AdminCardsController', function($scope, $rootScope, store, $location, storeService, authService, $timeout, CardList) {


        authService.adminAuthenticate();

        $rootScope.$broadcast('CHANGE_SIDEBAR_ITEM', 'cards', 'all_cards');

        $scope.cards = CardList;




        $timeout(function() {
            $('#datatable-default').dataTable();
        });

    });
};
},{}],4:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('AdminDealerProfileController', function($scope, $rootScope, store, $location, storeService, authService, $timeout, DealerProfile) {

        authService.adminAuthenticate();

        // $rootScope.$broadcast('CHANGE_SIDEBAR_ITEM', 'cards', 'orders');


        console.log(DealerProfile);
        $scope.user = DealerProfile;

        if ($scope.user.id === 0) {
            $scope.user.role = 'Guest';
            $scope.user.className = 'label-warning';
        } else {
            if ($scope.user.role === '' || $scope.user.role === undefined) {
                $scope.user.role = 'Regular User';
                $scope.user.className = 'label-primary';
            } else {
                if ($scope.user.role === 'user') {
                    $scope.user.role = 'Regular User';
                    $scope.user.className = 'label-primary';
                } else {
                    if ($scope.user.role === 'dealer') {
                        $scope.user.role = 'Dealer';
                        $scope.user.className = 'label-success';
                    }
                }
            }
        }

        $scope.receiptDetail = function(id) {
            $location.url('receipts/' + id);
        };

        $scope.goToOrderDetail = function(id) {
            $location.url('orders/' + id);
        };


        $timeout(function() {
            $('#datatable-orders').dataTable();
            $('#datatable-receipts').dataTable();

        });

    });
};
},{}],5:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('AdminDealersController', function($scope, $rootScope, store, $location, storeService, authService, $timeout, DealerList, userService) {

        authService.adminAuthenticate();
        $rootScope.$broadcast('CHANGE_SIDEBAR_ITEM', 'customers', 'dealers');

        console.log(DealerList);

        $scope.dealers = DealerList;

        $scope.dealerDeatail = function(id) {
            $location.url('dealer-profile/' + id);
        };


        $timeout(function() {



            var EditableTable = {

                options: {
                    addButton: '#addToTable',
                    table: '#datatable-default',
                    dialog: {
                        wrapper: '#dialog',
                        cancelButton: '#dialogCancel',
                        confirmButton: '#dialogConfirm',
                    }
                },

                initialize: function() {
                    this
                        .setVars()
                        .build()
                        .events();
                },

                setVars: function() {
                    this.$table = $(this.options.table);
                    this.$addButton = $(this.options.addButton);

                    // dialog
                    this.dialog = {};
                    this.dialog.$wrapper = $(this.options.dialog.wrapper);
                    this.dialog.$cancel = $(this.options.dialog.cancelButton);
                    this.dialog.$confirm = $(this.options.dialog.confirmButton);

                    return this;
                },

                build: function() {
                    this.datatable = this.$table.DataTable({

                    });

                    window.dt = this.datatable;

                    return this;
                },

                events: function() {
                    var _self = this;

                    this.$table
                        .on('click', 'a.save-row', function(e) {
                            e.preventDefault();

                            _self.rowSave($(this).closest('tr'));
                        })
                        .on('click', 'a.cancel-row', function(e) {
                            e.preventDefault();

                            _self.rowCancel($(this).closest('tr'));
                        })
                        .on('click', 'a.edit-row', function(e) {
                            e.preventDefault();

                            _self.rowEdit($(this).closest('tr'));
                        })
                        .on('click', 'a.remove-row', function(e) {
                            e.preventDefault();

                            var $row = $(this).closest('tr');

                            $.magnificPopup.open({
                                items: {
                                    src: _self.options.dialog.wrapper,
                                    type: 'inline'
                                },
                                preloader: false,
                                modal: true,
                                callbacks: {
                                    change: function() {
                                        _self.dialog.$confirm.on('click', function(e) {
                                            e.preventDefault();

                                            _self.rowRemove($row);
                                            $.magnificPopup.close();
                                        });
                                    },
                                    close: function() {
                                        _self.dialog.$confirm.off('click');
                                    }
                                }
                            });
                        });

                    this.$addButton.on('click', function(e) {
                        e.preventDefault();

                        _self.rowAdd();
                    });

                    this.dialog.$cancel.on('click', function(e) {
                        e.preventDefault();
                        $.magnificPopup.close();
                    });

                    return this;
                },

                // ==========================================================================================
                // ROW FUNCTIONS
                // ==========================================================================================
                rowAdd: function() {
                    this.$addButton.attr({
                        'disabled': 'disabled'
                    });

                    var actions,
                        data,
                        $row;

                    actions = [
                        '<a href="#" class="hidden on-editing save-row"><i class="fa fa-save"></i></a>',
                        '<a href="#" class="hidden on-editing cancel-row"><i class="fa fa-times"></i></a>',
                        '<a href="#" class="on-default edit-row"><i class="fa fa-pencil"></i></a>',
                        '<a href="#" class="on-default remove-row"><i class="fa fa-trash-o"></i></a>'
                    ].join(' ');

                    data = this.datatable.row.add(['', '', '', actions]);
                    $row = this.datatable.row(data[0]).nodes().to$();

                    $row
                        .addClass('adding')
                        .find('td:last')
                        .addClass('actions');

                    this.rowEdit($row);

                    this.datatable.order([0, 'asc']).draw(); // always show fields
                },

                rowCancel: function($row) {
                    var $actions,
                        data;

                    if ($row.hasClass('adding')) {
                        this.rowRemove($row);
                    } else {

                        data = this.datatable.row($row.get(0)).data();
                        this.datatable.row($row.get(0)).data(data);

                        $actions = $row.find('td.actions');
                        if ($actions.get(0)) {
                            this.rowSetActionsDefault($row);
                        }

                        this.datatable.draw();
                    }
                },

                rowEdit: function($row) {
                    var _self = this,
                        data;

                    data = this.datatable.row($row.get(0)).data();

                    $row.children('td').each(function(i) {
                        var $this = $(this);

                        if ($this.hasClass('actions')) {
                            _self.rowSetActionsEditing($row);
                        } else {
                            $this.html('<input type="text" class="form-control input-block" value="' + data[i] + '"/>');
                        }
                    });



                },

                rowSave: function($row) {
                    var _self = this,
                        $actions,
                        values = [];

                    if ($row.hasClass('adding')) {
                        this.$addButton.removeAttr('disabled');
                        $row.removeClass('adding');
                    }

                    values = $row.find('td').map(function() {
                        var $this = $(this);

                        if ($this.hasClass('actions')) {
                            _self.rowSetActionsDefault($row);
                            return _self.datatable.cell(this).data();
                        } else {
                            return $.trim($this.find('input').val());
                        }
                    });

                    this.datatable.row($row.get(0)).data(values);

                    $actions = $row.find('td.actions');
                    if ($actions.get(0)) {
                        this.rowSetActionsDefault($row);
                    }

                    this.datatable.draw();

                    var ret = {
                        id: parseInt(values[0]),
                        first_name: values[1],
                        last_name: values[2],
                        email: values[3],
                        address: values[4],
                        city: values[5],
                        state: values[6],
                        dealer_code: values[7],
                        business_name: values[8],
                        business_address: values[9],
                    };

                    userService.update({
                        id: ret.id
                    }, ret, function(ret) {
                        console.log('USER HAS BEEN UPDATED', ret);

                    }, function(err) {
                        swal('Error', err.data.message, 'error');
                    });

                    // console.log("data posted", ret);
                },

                rowRemove: function($row) {
                    if ($row.hasClass('adding')) {
                        this.$addButton.removeAttr('disabled');
                    }

                    this.datatable.row($row.get(0)).remove().draw();
                },

                rowSetActionsEditing: function($row) {
                    $row.find('.on-editing').removeClass('hidden');
                    $row.find('.on-default').addClass('hidden');
                },

                rowSetActionsDefault: function($row) {
                    $row.find('.on-editing').addClass('hidden');
                    $row.find('.on-default').removeClass('hidden');
                }

            };

            EditableTable.initialize();

        });

    });
};
},{}],6:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('AdminGuestsController', function($scope, $rootScope, store, $location, storeService, authService, $timeout, GuestList, GuestType) {
        authService.adminAuthenticate();

        $rootScope.$broadcast('CHANGE_SIDEBAR_ITEM', 'customers', 'guests');

        $scope.users = GuestList;

        $scope.type = GuestType;

        $timeout(function() {
            $('#datatable-default').dataTable();
        });
    });
};
},{}],7:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('AdminHeadController', function($scope, $rootScope, store, $location, storeService, authService, userService) {

        $scope.logout = function() {

            store.remove('admin');
            window.location = '/admin-login/#/';
        };
    });
};
},{}],8:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('AdminIndexController', function($scope, $rootScope, store, $location, storeService, authService, SiteStats) {

        authService.adminAuthenticate();

        $rootScope.$broadcast('CHANGE_SIDEBAR_ITEM', 'dashboard', '');

        $scope.stats = SiteStats;

        $scope.range = 1;
        $scope.currentTab = 'all';


        storeService.dateRanges().$promise.then(function(dat) {
            $scope.dateRanges = dat;

            $scope.dateRanges.min_date = new Date($scope.dateRanges.min_date);
            $scope.dateRanges.max_date = new Date($scope.dateRanges.max_date);

            var one_day = 1000 * 60 * 60 * 24;
            var one_week = 1000 * 60 * 60 * 24 * 7;
            var one_month = 1000 * 60 * 60 * 24 * 30;

            var date1_ms = $scope.dateRanges.min_date.getTime();
            var date2_ms = $scope.dateRanges.max_date.getTime();

            var difference_ms = date2_ms - date1_ms;

            $scope.nDays = Math.round(difference_ms / one_day);
            $scope.nWeeks = Math.round(difference_ms / one_week);
            $scope.nMonths = Math.round(difference_ms / one_month);

            // console.log("mexx", $scope.dateRanges);
        });


        $scope.all = function() {
            $scope.currentTab = 'all';
            $scope.range = 1;
        };
        $scope.daily = function() {
            $scope.currentTab = 'daily';
            $scope.range = $scope.nDays;
        };
        $scope.weekly = function() {
            $scope.currentTab = 'weekly';
            $scope.range = $scope.nWeeks;
        };
        $scope.monthly = function() {
            $scope.currentTab = 'monthly';
            $scope.range = $scope.nMonths;
        };


        // 




        console.log(SiteStats, $scope.dateRanges);

    });
};
},{}],9:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('AdminInventoryRetailerController', function($scope, $rootScope, store, $location, storeService, authService, $timeout, Retailers) {


        authService.adminAuthenticate();

        $rootScope.$broadcast('CHANGE_SIDEBAR_ITEM', 'inventory', '');

        $scope.retailers = Retailers;


        $timeout(function() {
            $('#datatable-default').dataTable();
        });

    });
};
},{}],10:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('AdminInventoryController', function($scope, $rootScope, store, $location, storeService, authService, $timeout, CardList) {


        authService.adminAuthenticate();

        $rootScope.$broadcast('CHANGE_SIDEBAR_ITEM', 'inventory', '');

        $scope.cards = CardList;


        $timeout(function() {
            $('#datatable-default').dataTable();
        });

    });
};
},{}],11:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('AdminLoginController', function($scope, $rootScope, store, $location, storeService, authService, userService) {

        $scope.login = function() {
            userService.adminLogin($scope.user, function(ret) {


                store.set('admin', ret);


                window.location = '/dashboard/#/';

            }, function(err) {
                swal('Error', err.data.message, 'error');
                $scope.user.username = '';
                $scope.user.password = '';
            });
        };
    });
};
},{}],12:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('AdminOrderDetailController', function($scope, $rootScope, store, $location, storeService, authService, $timeout, OrderDetail, orderService) {

        authService.adminAuthenticate();

        $rootScope.$broadcast('CHANGE_SIDEBAR_ITEM', 'cards', 'orders');


        console.log(OrderDetail);

        $scope.order = OrderDetail;

        if ($scope.order.billingUser.id === 0) {
            $scope.order.billingUser.role = 'Guest';
            $scope.order.billingUser.className = 'label-warning';
        } else {
            if ($scope.order.billingUser.role === '' || $scope.order.billingUser.role === undefined) {
                $scope.order.billingUser.role = 'Regular User';
                $scope.order.billingUser.className = 'label-primary';
            } else {
                if ($scope.order.billingUser.role === 'user') {
                    $scope.order.billingUser.role = 'Regular User';
                    $scope.order.billingUser.className = 'label-primary';
                }
            }
        }

        $timeout(function() {
            $('#datatable-default').dataTable();
        });


        $scope.sendGiftCards = function() {
            swal({
                    title: 'Are you sure?',
                    text: 'Do you want to send the gift cards to the email: ' + $scope.order.billingUser.email,
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#47A447',
                    confirmButtonText: 'Yes, Send Gift Cards',
                    closeOnConfirm: true
                },
                function() {
                    orderService.sendGiftCards({
                        id: $scope.order.id
                    }, function(ret) {

                        if (ret.status === 'error') {
                            swal('Error', ret.message, 'error');
                        } else {
                            swal('Success', 'The gift cards have been sent to the email: ' + $scope.order.billingUser.email, 'success');
                        }
                        console.log('ORDER SERVICE', ret, 'success');
                    });
                });
        };

    });
};
},{}],13:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('AdminOrdersController', function($scope, $rootScope, store, $location, storeService, authService, $timeout, Orders) {

        authService.adminAuthenticate();



        $rootScope.$broadcast('CHANGE_SIDEBAR_ITEM', 'cards', 'orders');

        $scope.orders = Orders;

        for (var i = 0; i < $scope.orders.length; i = i + 1) {
            if ($scope.orders[i].billingUser.id === 0) {
                $scope.orders[i].billingUser.role = 'Guest';
                $scope.orders[i].billingUser.className = 'label-warning';
            } else {
                if ($scope.orders[i].billingUser.role === '' || $scope.orders[i].billingUser.role === undefined) {
                    $scope.orders[i].billingUser.role = 'User';
                    $scope.orders[i].billingUser.className = 'label-primary';
                } else {
                    if ($scope.orders[i].billingUser.role === 'user') {
                        $scope.orders[i].billingUser.role = 'User';
                        $scope.orders[i].billingUser.className = 'label-primary';
                    } else {
                        if ($scope.orders[i].billingUser.role === 'dealer') {
                            $scope.orders[i].billingUser.role = 'Dealer';
                            $scope.orders[i].billingUser.className = 'label-success';
                        }
                    }
                }
            }

            var cards = $scope.orders[i].cards;
            var storeList = [];

            for (var j = 0; j < cards.length; j = j + 1) {
                if (storeList.indexOf(cards[j].name) === -1) {
                    storeList.push(cards[j].name);
                }
            }

            $scope.orders[i].storeList = storeList;

        }

        console.log('order', $scope.orders);

        $scope.goToOrderDetail = function(id) {
            $location.url('orders/' + id);
        };

        $timeout(function() {
            $('#datatable-default').dataTable();
        });

    });
};
},{}],14:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('AdminPendingCardsController', function($scope, $rootScope, store, $location, storeService, authService, $timeout, ReceiptList, sellingCardsService) {


        authService.adminAuthenticate();

        $rootScope.$broadcast('CHANGE_SIDEBAR_ITEM', 'cards', 'pending_cards');



        $scope.receipts = ReceiptList;



        $timeout(function() {
            $('#datatable-default').dataTable({
                paging: false
            });
        });

        for (var i = 0; i < $scope.receipts.length; i = i + 1) {
            if ($scope.receipts[i].billingUser.id === 0) {
                $scope.receipts[i].billingUser.role = 'Guest';
                $scope.receipts[i].billingUser.className = 'label-warning';
            } else {
                if ($scope.receipts[i].billingUser.role === '' || $scope.receipts[i].billingUser.role === undefined) {
                    $scope.receipts[i].billingUser.role = 'User';
                    $scope.receipts[i].billingUser.className = 'label-primary';
                } else {
                    if ($scope.receipts[i].billingUser.role === 'user') {
                        $scope.receipts[i].billingUser.role = 'User';
                        $scope.receipts[i].billingUser.className = 'label-primary';
                    } else {
                        if ($scope.receipts[i].billingUser.role === 'dealer') {
                            $scope.receipts[i].billingUser.role = 'Dealer';
                            $scope.receipts[i].billingUser.className = 'label-success';
                        }
                    }
                }
            }
        }

        $scope.receiptDetail = function(id) {
            $location.url('receipts/' + id);
        };

    });
};
},{}],15:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('AdminReceiptDetailController', function($scope, $rootScope, store, $location, storeService, authService, $timeout, ReceiptDetail, receiptService) {

        authService.adminAuthenticate();


        $rootScope.$broadcast('CHANGE_SIDEBAR_ITEM', 'cards', 'receipts');

        console.log(ReceiptDetail);

        $scope.receipt = ReceiptDetail;

        if ($scope.receipt.billingUser.id === 0) {
            $scope.receipt.billingUser.role = 'Guest';
            $scope.receipt.billingUser.className = 'label-warning';
        } else {
            if ($scope.receipt.billingUser.role === '' || $scope.receipt.billingUser.role === undefined) {
                $scope.receipt.billingUser.role = 'Regular User';
                $scope.receipt.billingUser.className = 'label-primary';
            } else {
                if ($scope.receipt.billingUser.role === 'user') {
                    $scope.receipt.billingUser.role = 'Regular User';
                    $scope.receipt.billingUser.className = 'label-primary';
                } else {
                    if ($scope.receipt.billingUser.role === 'dealer') {
                        $scope.receipt.billingUser.role = 'Dealer';
                        $scope.receipt.billingUser.className = 'label-success';
                    }
                }
            }
        }


        $scope.addToInventory = function() {

            swal({
                    title: 'Are you sure?',
                    text: 'Do you want to add all these cards to the inventory',
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#47A447',
                    confirmButtonText: 'Yes, Add These Cards',
                    closeOnConfirm: true
                },
                function() {
                    if ($scope.receipt.status === 'pending') {
                        receiptService.putToInventory({
                            id: $scope.receipt.id
                        }, function(ret) {
                            if (ret.status === 'fail') {
                                swal('Error', ret.message, 'error');
                            } else {
                                // $scope.receipt.status = 'ok';

                                // for (var i = 0; i < $scope.receipt.cards.length; i++) {
                                //     $scope.receipt.cards[i].status = 'ok';
                                // };
                                window.location.reload(true);
                            }
                        });
                    }
                });


        };

        $timeout(function() {
            $('#datatable-default').dataTable();
        });
    });
};
},{}],16:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('AdminReceiptsController', function($scope, $rootScope, store, $location, storeService, authService, $timeout, Receipts) {


        authService.adminAuthenticate();

        $rootScope.$broadcast('CHANGE_SIDEBAR_ITEM', 'cards', 'receipts');

        console.log(Receipts);

        $scope.receipts = Receipts;

        for (var i = 0; i < $scope.receipts.length; i = i + 1) {
            if ($scope.receipts[i].billingUser.id === 0) {
                $scope.receipts[i].billingUser.role = 'Guest';
                $scope.receipts[i].billingUser.className = 'label-warning';
            } else {
                if ($scope.receipts[i].billingUser.role === '' || $scope.receipts[i].billingUser.role === undefined) {
                    $scope.receipts[i].billingUser.role = 'User';
                    $scope.receipts[i].billingUser.className = 'label-primary';
                } else {
                    if ($scope.receipts[i].billingUser.role === 'user') {
                        $scope.receipts[i].billingUser.role = 'User';
                        $scope.receipts[i].billingUser.className = 'label-primary';
                    } else {
                        if ($scope.receipts[i].billingUser.role === 'dealer') {
                            $scope.receipts[i].billingUser.role = 'Dealer';
                            $scope.receipts[i].billingUser.className = 'label-success';
                        }
                    }
                }
            }
        }

        $scope.receiptDetail = function(id) {


            $location.url('receipts/' + id);
        };



        $timeout(function() {
            $('#datatable-default').dataTable();
        });
    });
};
},{}],17:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('AdminRetailerLimitController', function($scope, $rootScope, store, $location, storeService, authService, $timeout, Retailers) {


        authService.adminAuthenticate();

        $rootScope.$broadcast('CHANGE_SIDEBAR_ITEM', 'retailer-limits', '');

        // console.log('Retailers', Retailers);

        $scope.retailers = Retailers;

        $timeout(function() {



            var EditableTable = {

                options: {
                    addButton: '#addToTable',
                    table: '#datatable-default',
                    dialog: {
                        wrapper: '#dialog',
                        cancelButton: '#dialogCancel',
                        confirmButton: '#dialogConfirm',
                    }
                },

                initialize: function() {
                    this
                        .setVars()
                        .build()
                        .events();
                },

                setVars: function() {
                    this.$table = $(this.options.table);
                    this.$addButton = $(this.options.addButton);

                    // dialog
                    this.dialog = {};
                    this.dialog.$wrapper = $(this.options.dialog.wrapper);
                    this.dialog.$cancel = $(this.options.dialog.cancelButton);
                    this.dialog.$confirm = $(this.options.dialog.confirmButton);

                    return this;
                },

                build: function() {
                    this.datatable = this.$table.DataTable({
                        paging: false
                    });

                    window.dt = this.datatable;

                    return this;
                },

                events: function() {
                    var _self = this;

                    this.$table
                        .on('click', 'a.save-row', function(e) {
                            e.preventDefault();

                            _self.rowSave($(this).closest('tr'));
                        })
                        .on('click', 'a.cancel-row', function(e) {
                            e.preventDefault();

                            _self.rowCancel($(this).closest('tr'));
                        })
                        .on('click', 'a.edit-row', function(e) {
                            e.preventDefault();

                            _self.rowEdit($(this).closest('tr'));
                        })
                        .on('click', 'a.remove-row', function(e) {
                            e.preventDefault();

                            var $row = $(this).closest('tr');

                            $.magnificPopup.open({
                                items: {
                                    src: _self.options.dialog.wrapper,
                                    type: 'inline'
                                },
                                preloader: false,
                                modal: true,
                                callbacks: {
                                    change: function() {
                                        _self.dialog.$confirm.on('click', function(e) {
                                            e.preventDefault();

                                            _self.rowRemove($row);
                                            $.magnificPopup.close();
                                        });
                                    },
                                    close: function() {
                                        _self.dialog.$confirm.off('click');
                                    }
                                }
                            });
                        });

                    this.$addButton.on('click', function(e) {
                        e.preventDefault();

                        _self.rowAdd();
                    });

                    this.dialog.$cancel.on('click', function(e) {
                        e.preventDefault();
                        $.magnificPopup.close();
                    });

                    return this;
                },

                // ==========================================================================================
                // ROW FUNCTIONS
                // ==========================================================================================
                rowAdd: function() {
                    this.$addButton.attr({
                        'disabled': 'disabled'
                    });

                    var actions,
                        data,
                        $row;

                    actions = [
                        '<a href="#" class="hidden on-editing save-row"><i class="fa fa-save"></i></a>',
                        '<a href="#" class="hidden on-editing cancel-row"><i class="fa fa-times"></i></a>',
                        '<a href="#" class="on-default edit-row"><i class="fa fa-pencil"></i></a>',
                        '<a href="#" class="on-default remove-row"><i class="fa fa-trash-o"></i></a>'
                    ].join(' ');

                    data = this.datatable.row.add(['', '', '', actions]);
                    $row = this.datatable.row(data[0]).nodes().to$();

                    $row
                        .addClass('adding')
                        .find('td:last')
                        .addClass('actions');

                    this.rowEdit($row);

                    this.datatable.order([0, 'asc']).draw(); // always show fields
                },

                rowCancel: function($row) {
                    var $actions,
                        data;

                    if ($row.hasClass('adding')) {
                        this.rowRemove($row);
                    } else {

                        data = this.datatable.row($row.get(0)).data();
                        this.datatable.row($row.get(0)).data(data);

                        $actions = $row.find('td.actions');
                        if ($actions.get(0)) {
                            this.rowSetActionsDefault($row);
                        }

                        this.datatable.draw();
                    }
                },

                rowEdit: function($row) {
                    var _self = this,
                        data;

                    data = this.datatable.row($row.get(0)).data();

                    $row.children('td').each(function(i) {
                        var $this = $(this);

                        if ($this.hasClass('actions')) {
                            _self.rowSetActionsEditing($row);
                        } else {
                            $this.html('<input type="text" class="form-control input-block" value="' + data[i] + '"/>');
                        }
                    });



                },

                rowSave: function($row) {
                    var _self = this,
                        $actions,
                        values = [];

                    if ($row.hasClass('adding')) {
                        this.$addButton.removeAttr('disabled');
                        $row.removeClass('adding');
                    }

                    values = $row.find('td').map(function() {
                        var $this = $(this);

                        if ($this.hasClass('actions')) {
                            _self.rowSetActionsDefault($row);
                            return _self.datatable.cell(this).data();
                        } else {
                            return $.trim($this.find('input').val());
                        }
                    });

                    var ret = {
                        id: parseInt(values[0]),
                        name: values[2],
                        limit: parseInt(values[3]),
                        inventory: parseInt(values[4]),
                        retailer_id: parseInt(values[5]),
                    };

                    if (ret.limit < ret.inventory) {
                        swal('Error', 'You cannot update the limit. The limit has to be greater than the number of cards in current inventory', 'error');
                    } else {

                        this.datatable.row($row.get(0)).data(values);

                        $actions = $row.find('td.actions');
                        if ($actions.get(0)) {
                            this.rowSetActionsDefault($row);
                        }

                        this.datatable.draw();

                        storeService.update({
                            id: ret.id
                        }, ret, function(ret) {
                            console.log('STORE HAS BEEN UPDATED', ret);

                            // update the $scope.retailers
                            for (var i = 0; i < $scope.retailers.length; i = i + 1) {
                                if ($scope.retailers[i].id === ret.id) {
                                    $scope.retailers[i].limit = ret.limit;
                                }
                            }

                        }, function(err) {
                            swal('Error', err.data.message, 'error');
                        });
                    }


                    console.log('data posted', ret);
                },

                rowRemove: function($row) {
                    if ($row.hasClass('adding')) {
                        this.$addButton.removeAttr('disabled');
                    }

                    this.datatable.row($row.get(0)).remove().draw();
                },

                rowSetActionsEditing: function($row) {
                    $row.find('.on-editing').removeClass('hidden');
                    $row.find('.on-default').addClass('hidden');
                },

                rowSetActionsDefault: function($row) {
                    $row.find('.on-editing').addClass('hidden');
                    $row.find('.on-default').removeClass('hidden');
                }

            };

            EditableTable.initialize();

        });

    });
};
},{}],18:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('AdminSettingsController', function($scope, $rootScope, store, $location, settingService, authService, $timeout, Settings) {


        authService.adminAuthenticate();

        $rootScope.$broadcast('CHANGE_SIDEBAR_ITEM', 'settings', '');

        // console.log('Settings', Settings);

        $scope.settings = Settings;

        $timeout(function() {

            var EditableTable = {

                options: {
                    addButton: '#addToTable',
                    table: '#datatable-default',
                    dialog: {
                        wrapper: '#dialog',
                        cancelButton: '#dialogCancel',
                        confirmButton: '#dialogConfirm',
                    }
                },

                initialize: function() {
                    this
                        .setVars()
                        .build()
                        .events();
                },

                setVars: function() {
                    this.$table = $(this.options.table);
                    this.$addButton = $(this.options.addButton);

                    // dialog
                    this.dialog = {};
                    this.dialog.$wrapper = $(this.options.dialog.wrapper);
                    this.dialog.$cancel = $(this.options.dialog.cancelButton);
                    this.dialog.$confirm = $(this.options.dialog.confirmButton);

                    return this;
                },

                build: function() {
                    this.datatable = this.$table.DataTable({
                        paging: false
                    });

                    window.dt = this.datatable;

                    return this;
                },

                events: function() {
                    var _self = this;

                    this.$table
                        .on('click', 'a.save-row', function(e) {
                            e.preventDefault();

                            _self.rowSave($(this).closest('tr'));
                        })
                        .on('click', 'a.cancel-row', function(e) {
                            e.preventDefault();

                            _self.rowCancel($(this).closest('tr'));
                        })
                        .on('click', 'a.edit-row', function(e) {
                            e.preventDefault();

                            _self.rowEdit($(this).closest('tr'));
                        })
                        .on('click', 'a.remove-row', function(e) {
                            e.preventDefault();

                            var $row = $(this).closest('tr');

                            $.magnificPopup.open({
                                items: {
                                    src: _self.options.dialog.wrapper,
                                    type: 'inline'
                                },
                                preloader: false,
                                modal: true,
                                callbacks: {
                                    change: function() {
                                        _self.dialog.$confirm.on('click', function(e) {
                                            e.preventDefault();

                                            _self.rowRemove($row);
                                            $.magnificPopup.close();
                                        });
                                    },
                                    close: function() {
                                        _self.dialog.$confirm.off('click');
                                    }
                                }
                            });
                        });

                    this.$addButton.on('click', function(e) {
                        e.preventDefault();

                        _self.rowAdd();
                    });

                    this.dialog.$cancel.on('click', function(e) {
                        e.preventDefault();
                        $.magnificPopup.close();
                    });

                    return this;
                },

                // ==========================================================================================
                // ROW FUNCTIONS
                // ==========================================================================================
                rowAdd: function() {
                    this.$addButton.attr({
                        'disabled': 'disabled'
                    });

                    var actions,
                        data,
                        $row;

                    actions = [
                        '<a href="#" class="hidden on-editing save-row"><i class="fa fa-save"></i></a>',
                        '<a href="#" class="hidden on-editing cancel-row"><i class="fa fa-times"></i></a>',
                        '<a href="#" class="on-default edit-row"><i class="fa fa-pencil"></i></a>',
                        '<a href="#" class="on-default remove-row"><i class="fa fa-trash-o"></i></a>'
                    ].join(' ');

                    data = this.datatable.row.add(['', '', '', actions]);
                    $row = this.datatable.row(data[0]).nodes().to$();

                    $row
                        .addClass('adding')
                        .find('td:last')
                        .addClass('actions');

                    this.rowEdit($row);

                    this.datatable.order([0, 'asc']).draw(); // always show fields
                },

                rowCancel: function($row) {
                    var $actions,
                        data;

                    if ($row.hasClass('adding')) {
                        this.rowRemove($row);
                    } else {

                        data = this.datatable.row($row.get(0)).data();
                        this.datatable.row($row.get(0)).data(data);

                        $actions = $row.find('td.actions');
                        if ($actions.get(0)) {
                            this.rowSetActionsDefault($row);
                        }

                        this.datatable.draw();
                    }
                },

                rowEdit: function($row) {
                    var _self = this,
                        data;

                    data = this.datatable.row($row.get(0)).data();

                    $row.children('td').each(function(i) {
                        var $this = $(this);

                        if ($this.hasClass('actions')) {
                            _self.rowSetActionsEditing($row);
                        } else {
                            $this.html('<input type="text" class="form-control input-block" value="' + data[i] + '"/>');
                        }
                    });



                },

                rowSave: function($row) {
                    var _self = this,
                        $actions,
                        values = [];

                    if ($row.hasClass('adding')) {
                        this.$addButton.removeAttr('disabled');
                        $row.removeClass('adding');
                    }

                    values = $row.find('td').map(function() {
                        var $this = $(this);

                        if ($this.hasClass('actions')) {
                            _self.rowSetActionsDefault($row);
                            return _self.datatable.cell(this).data();
                        } else {
                            return $.trim($this.find('input').val());
                        }
                    });

                    var ret = {
                        id: parseInt(values[0]),
                        value: values[2],
                        description: values[3],
                    };

                    console.log('update', ret);

                    this.datatable.row($row.get(0)).data(values);

                    $actions = $row.find('td.actions');
                    if ($actions.get(0)) {
                        this.rowSetActionsDefault($row);
                    }

                    this.datatable.draw();

                    settingService.update({
                        id: ret.id
                    }, ret, function(ret) {
                        console.log('SETTING HAS BEEN UPDATED', ret);

                        // update the $scope.retailers
                        // for (var i = 0; i < $scope.retailers.length; i = i + 1) {
                        //     if ($scope.retailers[i].id === ret.id) {
                        //         $scope.retailers[i].limit = ret.limit;
                        //     }
                        // }

                    }, function(err) {
                        swal('Error', err.data.message, 'error');
                    });

                },

                rowRemove: function($row) {
                    if ($row.hasClass('adding')) {
                        this.$addButton.removeAttr('disabled');
                    }

                    this.datatable.row($row.get(0)).remove().draw();
                },

                rowSetActionsEditing: function($row) {
                    $row.find('.on-editing').removeClass('hidden');
                    $row.find('.on-default').addClass('hidden');
                },

                rowSetActionsDefault: function($row) {
                    $row.find('.on-editing').addClass('hidden');
                    $row.find('.on-default').removeClass('hidden');
                }

            };

            EditableTable.initialize();

        });

    });
};
},{}],19:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('AdminSideBarController', function($scope, $rootScope, store, $location, storeService, authService) {
        authService.adminAuthenticate();
        $scope.currentActiveParent = 'dashboard';
        $scope.currentActiveChild = '';
        $rootScope.$on('CHANGE_SIDEBAR_ITEM', function(event, parent, child) {
            console.log('parent child', parent, child);
            $scope.currentActiveParent = parent;
            $scope.currentActiveChild = child;
        });


        $scope.popularBought = storeService.popularBought();

        $scope.popularSold = storeService.popularSold();

        $scope.average = storeService.average();




    });
};
},{}],20:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('AdminSoldCardsController', function($scope, $rootScope, store, $location, storeService, authService, $timeout, CardList) {


        authService.adminAuthenticate();

        $rootScope.$broadcast('CHANGE_SIDEBAR_ITEM', 'cards', 'sold_cards');

        $scope.cards = CardList;


        for (var i = 0; i < $scope.cards.length; i = i + 1) {
            var gogo_buy = $scope.cards[i].gogo_buy;
            var discount = $scope.cards[i].purchase.save;
            $scope.cards[i].spread = (100 - gogo_buy - discount) / (100 - discount) * 100;

        }




        $timeout(function() {
            $('#datatable-default').dataTable();
        });

    });
};
},{}],21:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('AdminTransactionDetailController', function($scope, $rootScope, store, $location, storeService, authService, $timeout, TransactionDetail) {

        authService.adminAuthenticate();


        $rootScope.$broadcast('CHANGE_SIDEBAR_ITEM', 'transactions', '');

        console.log(TransactionDetail);

        $scope.transaction = TransactionDetail;

        if ($scope.transaction.billingUser.id === 0) {
            $scope.transaction.billingUser.role = 'Guest';
            $scope.transaction.billingUser.className = 'label-warning';
        } else {
            if ($scope.transaction.billingUser.role === '' || $scope.transaction.billingUser.role === undefined) {
                $scope.transaction.billingUser.role = 'Regular User';
                $scope.transaction.billingUser.className = 'label-primary';
            } else {
                if ($scope.transaction.billingUser.role === 'user') {
                    $scope.transaction.billingUser.role = 'Regular User';
                    $scope.transaction.billingUser.className = 'label-primary';
                } else {
                    if ($scope.transaction.billingUser.role === 'dealer') {
                        $scope.transaction.billingUser.role = 'Dealer';
                        $scope.transaction.billingUser.className = 'label-success';
                    }
                }
            }
        }




        $timeout(function() {
            $('#datatable-default').dataTable();
        });
    });
};
},{}],22:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('AdminTransactionsController', function($scope, $rootScope, store, $location, storeService, authService, $timeout, Transactions) {


        authService.adminAuthenticate();

        $rootScope.$broadcast('CHANGE_SIDEBAR_ITEM', 'transactions', '');


        $scope.transactions = Transactions;

        for (var i = 0; i < $scope.transactions.length; i = i + 1) {
            if ($scope.transactions[i].billingUser.id === 0) {
                $scope.transactions[i].billingUser.role = 'Guest';
                $scope.transactions[i].billingUser.className = 'label-warning';
            } else {
                if ($scope.transactions[i].billingUser.role === '' || $scope.transactions[i].billingUser.role === undefined) {
                    $scope.transactions[i].billingUser.role = 'User';
                    $scope.transactions[i].billingUser.className = 'label-primary';
                } else {
                    if ($scope.transactions[i].billingUser.role === 'user') {
                        $scope.transactions[i].billingUser.role = 'User';
                        $scope.transactions[i].billingUser.className = 'label-primary';
                    } else {
                        if ($scope.transactions[i].billingUser.role === 'dealer') {
                            $scope.transactions[i].billingUser.role = 'Dealer';
                            $scope.transactions[i].billingUser.className = 'label-success';
                        }
                    }
                }
            }
        }

        $scope.transactionDetail = function(id) {


            $location.url('transactions/' + id);
        };



        $timeout(function() {
            $('#datatable-default').dataTable();
        });
    });
};
},{}],23:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('AdminUserProfileController', function($scope, $rootScope, store, $location, storeService, authService, $timeout, UserProfile) {

        authService.adminAuthenticate();

        // $rootScope.$broadcast('CHANGE_SIDEBAR_ITEM', 'cards', 'orders');


        console.log(UserProfile);
        $scope.user = UserProfile;

        if ($scope.user.id === 0) {
            $scope.user.role = 'Guest';
            $scope.user.className = 'label-warning';
        } else {
            if ($scope.user.role === '' || $scope.user.role === undefined) {
                $scope.user.role = 'Regular User';
                $scope.user.className = 'label-primary';
            } else {
                if ($scope.user.role === 'user') {
                    $scope.user.role = 'Regular User';
                    $scope.user.className = 'label-primary';
                } else {
                    if ($scope.user.role === 'dealer') {
                        $scope.user.role = 'Dealer';
                        $scope.user.className = 'label-success';
                    }
                }
            }
        }

        $scope.receiptDetail = function(id) {
            $location.url('receipts/' + id);
        };

        $scope.goToOrderDetail = function(id) {
            $location.url('orders/' + id);
        };


        $timeout(function() {
            $('#datatable-orders').dataTable();
            $('#datatable-receipts').dataTable();

        });

    });
};
},{}],24:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('AdminUsersController', function($scope, $rootScope, store, $location, storeService, authService, $timeout, UserList) {


        authService.adminAuthenticate();

        $rootScope.$broadcast('CHANGE_SIDEBAR_ITEM', 'customers', 'users');

        console.log(UserList);

        $scope.users = UserList;

        $scope.userProfile = function(id) {
            $location.url('user-profile/' + id);
        };


        $timeout(function() {
            $('#datatable-default').dataTable();
        });
    });
};
},{}],25:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('CheckoutController', ['$scope', '$location', '$routeParams', 'authService', 'store',
        function($scope, $location, $routeParams, authService, store) {

            $scope.selectedCards = store.get('cart');


            if (!authService.isAuthenticated()) {
                $scope.isGuest = true;
                $scope.user = {
                    id: 0 // guest id set to 0
                };
            } else {
                $scope.isGuest = false;
                $scope.user = store.get('user');

            }


            $scope.payment = {
                name: 'cc_terminal'
            };






            // Calculate cards' stats
            var total = 0;
            var totalFaceValue = 0;
            var totalPercentage = 0;

            for (var i = 0; i < $scope.selectedCards.length; i = i + 1) {
                var card = $scope.selectedCards[i];
                total += card.pay;
                totalFaceValue += card.value;
                totalPercentage += (card.pay / card.value * 100);
            }
            $scope.total = total;
            $scope.totalFaceValue = totalFaceValue;
            $scope.averagePercentage = 100 - totalPercentage / $scope.selectedCards.length;


            $scope.placeOrder = function(paymentForm) {

                if ($scope.agreed === false) {
                    swal('Warning', 'You have to agree the terms and conditions', 'warnning');
                    return;
                }

                var order = {
                    billingUser: $scope.user,
                    cards: $scope.selectedCards,
                    payment: $scope.payment.name
                };


                if ($scope.payment.name === 'ach') {
                    swal('Error', 'No payment support', 'error');
                    return;
                }

                if (paymentForm.cardNumber.$valid === false) {
                    swal('Error', 'The card number is not valid', 'error');
                    return;
                }


                console.log('payment', $scope.payment.name);
                // return;

                store.set('order', order);

                window.location = '/checkout/#/review_order';
            };
        }
    ]);
};
},{}],26:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('ForgetPasswordController', ['$scope', '$location', '$routeParams', 'authService', 'store', 'userService',
        function($scope, $location, $routeParams, authService, store, userService) {

            $scope.forgetPassword = function() {

                userService.forgetPassword({
                    email: $scope.email
                }, function(ret) {
                    console.log(ret);
                    $scope.email = '';
                    swal({
                        title: 'Done',
                        text: 'An email to reset your password has been sent to your email',
                        type: 'success',
                        showCancelButton: true,
                        confirmButtonText: 'Go To Homepage',
                        closeOnConfirm: false,
                        confirmButtonColor: '#08C',
                    }, function() {
                        window.location = '/';
                    });
                }, function(err) {
                    swal('Error', err.data.message, 'error');
                });
            };

        }
    ]);
};
},{}],27:[function(require,module,exports){
'use strict';

module.exports = function(m) {
    m.controller('HeaderController', ['$scope', '$rootScope', 'store', '$location', 'authService', '$routeParams', 'storeService',
        function($scope, $rootScope, store, $location, authService, $routeParams, storeService) {


            console.log('HEADER Route PARAM', $routeParams);

            function capitalizeFirstLetter(str) {
                return str.replace(/\w\S*/g, function(txt) {
                    return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
                });
            }

            var getTotal = function(cards) {
                var total = 0;
                for (var i = cards.length - 1; i >= 0; i = i - 1) {
                    total += cards[i].pay;
                }
                // return total;

                return Math.round(total * 100) / 100;
            };

            var m, n;

            storeService.get().$promise.then(function(stores) {
                $scope.allStores = stores;
                for (var i = 0; i < $scope.allStores.length; i = i + 1) {
                    $scope.allStores[i].originalName = $scope.allStores[i].name;
                    $scope.allStores[i].name = capitalizeFirstLetter($scope.allStores[i].name.split('-').join(' '));
                }

            });


            if (authService.isAuthenticated()) {
                $scope.loggedIn = true;
            } else {
                $scope.loggedIn = false;
            }

            $scope.showCheckout = false;

            // store.set("cart", []);
            $scope.selectedCards = [];
            var tmp = store.get('cart');
            if (tmp) {
                console.log(tmp);
                $scope.selectedCards = tmp;
                m = getTotal($scope.selectedCards);
                n = $scope.selectedCards.length;
                $scope.cartStat = 'Cart (' + n + ') - $ ' + m;

                if (n > 0) {
                    $scope.showCheckout = true;
                }
            }



            $rootScope.$on('CHANGE_CART', function() {
                $scope.selectedCards = store.get('cart');
                m = getTotal($scope.selectedCards);
                n = $scope.selectedCards.length;
                $scope.cartStat = 'Cart (' + n + ') - $' + m;

                if (n > 0) {
                    $scope.showCheckout = true;
                }

            });

            $scope.removeCard = function(index) {
                var cards = store.get('cart');
                cards.splice(index, 1);

                store.set('cart', cards);
                $scope.selectedCards = store.get('cart');
                m = getTotal($scope.selectedCards);
                n = $scope.selectedCards.length;
                $scope.cartStat = 'Cart (' + n + ') - $' + m;

            };

            $scope.viewShoppingCart = function() {
                window.location = '/shopping-cart/#/';
            };
            $scope.checkout = function() {
                var forwardUrl = btoa(window.location.origin + '/checkout');
                var loginURL = '/login/#/?forward_url=' + forwardUrl;

                // if user has not loggined yet
                if (!store.get('user')) {
                    swal({
                        title: 'Notice',
                        text: 'You can login before going to the next step <a href="' + loginURL + '">LOGIN NOW</a>  </br> Or you can continue to use the site as a guest',
                        type: 'warning',
                        showCancelButton: true,
                        confirmButtonText: 'Continue as guest',
                        closeOnConfirm: false,
                        confirmButtonColor: '#08C',
                        html: true
                    }, function() {
                        window.location = window.location.origin + '/checkout/#/?guest=true';
                        swal.close();
                    });
                } else {
                    window.location = '/checkout';
                }
            };

            $scope.signOut = function() {
                store.remove('user');
                window.location = '/';
            };

            $scope.searchStore = function() {
                if ($scope.searchedStore.originalName) {
                    window.location = '/stores/#/' + $scope.searchedStore.originalName;
                } else {
                    swal('Invalid Store', 'The store you are looking is not available', 'error');
                }
            };
        }
    ]);

};
},{}],28:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('HomeController', function($scope, store, $location, storeService, authService) {

        $scope.auth = authService.auth();

        // alert("HOME Controller");
        console.log('HOME CONTROLLER', storeService);

        $scope.featuredstoreService = storeService.featured();

        $scope.highestPayouts = storeService.highestPayout();

        $scope.login = function() {

        };

        $scope.logout = function() {

        };





        $scope.search = function() {
            window.location = '/search/#/?q=' + $scope.query;
        };

        $scope.go = function(path) {
            window.location = path;
        };




    });
};
},{}],29:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('LoginController', ['$scope', '$location', '$routeParams', 'authService', 'store', 'userService', 'isDealer',
        function($scope, $location, $routeParams, authService, store, userService, isDealer) {

            console.log('LOGIN', $routeParams);

            $scope.isDealer = isDealer;

            $scope.login = function() {
                userService.login($scope.user, function(ret) {


                    // if ((ret.role === 'dealer') && ($scope.isDealer === false)) {
                    //     swal('Error!', 'This login panel is for normal users', 'error');
                    //     return;
                    // }

                    // if ((ret.role === 'user') && ($scope.isDealer === true)) {
                    //     swal('Error!', 'This login panel is for dealers', 'error');
                    //     return;
                    // }


                    console.log(ret);
                    store.set('user', ret);


                    if ($routeParams.forward_url !== '' && $routeParams.forward_url !== undefined) {
                        console.log('$routeParams.forward_url', atob($routeParams.forward_url));
                        window.location = atob($routeParams.forward_url);
                    } else {
                        window.location = '/profile/';
                    }

                }, function(err) {
                    swal('Error', err.data.message, 'error');
                });
            };
        }
    ]);
};
},{}],30:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('ProfileEditController', ['$scope', '$location', '$routeParams', 'authService', 'store', 'userService',
        function($scope, $location, $routeParams, authService, store, userService) {

            if (!authService.isAuthenticated()) {
                window.location = '/unauthorized/';
            }

            $scope.user = store.get('user');
            console.log($scope.user, 'edit user');


            $scope.update = function(paymentForm) {
                console.log('user', $scope.user);

                console.log('payment', paymentForm);

                if (paymentForm.cardNumber.$valid === false) {
                    swal('Error', 'The card number is not valid', 'error');
                    return;
                }

                userService.update({
                    id: $scope.user.id
                }, $scope.user, function(ret) {
                    console.log('USER HAS BEEN UPDATED', ret);
                    store.set('user', ret);

                    window.location = '/profile/';

                }, function(err) {
                    swal('Error', err.data.message, 'error');
                });
            };
        }
    ]);
};
},{}],31:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('ProfileOrderDetailController', ['$scope', '$location', '$routeParams', 'authService', 'store', 'userService', 'orderService',
        function($scope, $location, $routeParams, authService, store, userService, orderService) {

            if (!authService.isAuthenticated()) {
                window.location = '/unauthorized/';
            }

            $scope.order = orderService.get({
                id: $routeParams.id
            }, function(order) {
                // Calculate cards' stats
                var total = 0;
                var totalFaceValue = 0;
                var totalPercentage = 0;

                for (var i = 0; i < $scope.order.cards.length; i = i + 1) {
                    var card = $scope.order.cards[i];
                    total += card.pay;
                    totalFaceValue += card.value;
                    totalPercentage += (card.pay / card.value * 100);
                }
                $scope.total = total;
                $scope.totalFaceValue = totalFaceValue;
                $scope.averagePercentage = 100 - totalPercentage / $scope.order.cards.length;

            });
        }
    ]);
};
},{}],32:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('ProfileOrderListController', ['$scope', '$location', '$routeParams', 'authService', 'store', 'userService',
        function($scope, $location, $routeParams, authService, store, userService) {

            if (!authService.isAuthenticated()) {
                window.location = '/unauthorized/';
            }

            var user = store.get('user');

            $scope.orders = userService.getOrdersByUserId({
                id: user.id,
            }, function(ret) {
                // console.log('RET', ret);
            }, function(err) {
                swal('Error', err.data.message, 'error');
            });


            $scope.orderDetail = function(id) {
                window.location = '/profile/#/orders/' + id;
            };
        }
    ]);
};
},{}],33:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('SoldCardDetailController', ['$scope', '$location', '$routeParams', 'authService', 'store', 'userService', 'SoldCardList',
        function($scope, $location, $routeParams, authService, store, userService, SoldCardList) {

            if (!authService.isAuthenticated()) {
                window.location = '/';
            } else {
                $scope.user = store.get('user');
            }

            if ($scope.user.role === 'dealer') {
                $scope.isDealer = true;
            } else {
                $scope.isDealer = false;
            }



            $scope.sellingCards = SoldCardList;

            // console.log('elling cards', $scope.sellingCards);

            $scope.total = $scope.sellingCards.total_amount;

            $scope.totalFaceValue = $scope.sellingCards.total_face_value;

            $scope.averagePayout = $scope.sellingCards.average_payout;


        }
    ]);
};
},{}],34:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('SoldCardListListController', ['$scope', '$location', '$routeParams', 'authService', 'store', 'userService', 'SoldCardsList',
        function($scope, $location, $routeParams, authService, store, userService, SoldCardsList) {

            if (!authService.isAuthenticated()) {
                window.location = '/unauthorized/';
            }

            // var user = store.get('user');

            $scope.soldCardsList = SoldCardsList;


            $scope.soldCardsDetail = function(id) {
                window.location = '/profile/#/sold-cards/' + id;
            };




            for (var i = 0; i < $scope.soldCardsList.length; i = i + 1) {

                var slides = [];
                var storeList = $scope.soldCardsList[i].store_list.split(',');

                console.log('store', storeList);
                for (var j = 0; j < storeList.length; j = j + 1) {

                    slides.push({
                        image: storeList[i],
                        text: ''
                    });

                }
                $scope.soldCardsList[i].slides = slides;

            }


        }
    ]);
};
},{}],35:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('ProfileController', ['$scope', '$location', '$routeParams', 'authService', 'store', 'userService',
        function($scope, $location, $routeParams, authService, store, userService) {

            if (!authService.isAuthenticated()) {
                window.location = '/unauthorized/';
            }

            $scope.user = store.get('user');

            if ($scope.user.role === 'dealer') {
                $scope.isDealer = true;
            } else {
                $scope.isDealer = false;
            }



        }
    ]);
};
},{}],36:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('RegisterController', ['$scope', '$location', '$routeParams', 'authService', 'store', 'userService', 'isDealer',
        function($scope, $location, $routeParams, authService, store, userService, isDealer) {


            $scope.isDealer = isDealer;

            $scope.signUp = function() {
                console.log('NEW USER', $scope.user);

                var user = angular.copy($scope.user);

                var UserService = userService;

                if (user.password !== user.password2) {
                    swal('Error!', 'Your password does not match', 'error');
                    return;
                }

                delete user.password2;

                if (isDealer === true) {
                    user.role = 'dealer';
                }

                var us = new UserService(user);
                us.$save(function(result) {
                    store.set('user', result);

                    window.location = '/profile';


                }, function(err) {
                    // console.log("ERRR", err);
                    swal('Error', err.data.message, 'error');
                });
            };
        }
    ]);
};
},{}],37:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('ResetPasswordController', ['$scope', '$location', '$routeParams', 'authService', 'store', 'userService',
        function($scope, $location, $routeParams, authService, store, userService) {



            $scope.resetPassword = function() {
                if ($scope.password !== $scope.password2) {
                    swal('Error!', 'Your password does not match', 'error');
                    return;
                }


                userService.resetPassword({
                    token: $routeParams.token,
                    password: $scope.password
                }, function(ret) {
                    console.log(ret);

                    $scope.password = '';
                    $scope.password2 = '';
                    swal({
                        title: 'Done',
                        text: 'Your password has been reset',
                        type: 'success',
                        showCancelButton: true,
                        confirmButtonText: 'Login',
                        closeOnConfirm: false,
                        confirmButtonColor: '#08C',
                    }, function() {
                        window.location = '/login/';
                    });

                }, function(err) {
                    swal('Error', err.data.message, 'error');
                });
            };

        }
    ]);
};
},{}],38:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('ReviewOrderController', ['$scope', '$location', '$routeParams', 'authService', 'store', 'userService', '$rootScope',
        function($scope, $location, $routeParams, authService, store, userService, $rootScope) {


            if (!authService.isAuthenticated()) {
                $scope.isGuest = true;
                $scope.user = {
                    id: 0 // guest id set to 0
                };
            } else {
                $scope.isGuest = false;
                $scope.user = store.get('user');
            }

            $scope.isPaid = false;



            $scope.order = store.get('order');

            if ($scope.order && $scope.order.cards === undefined) {
                alert('invalid page');

                window.location = '/';

                return;
            }



            console.log('order', $scope.order);


            // Calculate cards' stats
            var total = 0;
            var totalFaceValue = 0;
            var totalPercentage = 0;

            for (var i = 0; i < $scope.order.cards.length; i = i + 1) {
                var card = $scope.order.cards[i];
                total += card.pay;
                totalFaceValue += card.value;
                totalPercentage += (card.pay / card.value * 100);
            }
            $scope.total = total;
            $scope.totalFaceValue = totalFaceValue;
            $scope.averagePercentage = 100 - totalPercentage / $scope.order.cards.length;



            $scope.pay = function() {
                var order = {
                    user_id: $scope.user.id,
                    billing_user: $scope.order.billingUser,
                    cards: $scope.order.cards,
                    total_amount: total,
                    total_cards: $scope.order.cards.length,
                    total_face_value: $scope.totalFaceValue,
                    average_percentage: $scope.averagePercentage,
                    payment: $scope.order.payment
                };

                console.log('order', order);

                $scope.isPaid = true;


                userService.pay(order, function(result) {
                    // 
                    console.log('PAYMENT', result);
                    store.set('cart', []);

                    store.set('order', {});

                    if (!$scope.isGuest) {
                        swal({
                            title: 'Congratulations!',
                            text: 'Your Order has been paid!',
                            type: 'success',
                            showCancelButton: false,
                            confirmButtonText: 'Ok, view order!',
                            closeOnConfirm: false,
                            closeOnCancel: false
                        }, function() {
                            window.location = '/profile/#/orders/' + result.id;
                        });

                    } else {

                        swal('Congratulations!', 'Your Order has been paid', 'success');
                        $rootScope.$broadcast('CHANGE_CART', {});
                    }


                }, function(err) {
                    console.log('ERRR', err);
                    store.set('cart', []);

                    store.set('order', {});
                    // swal('Error', err.data.message, 'error');
                    window.location = '/payment-declined';
                });
            };

        }
    ]);
};
},{}],39:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('SellCardInfoController', ['$scope', '$location', '$routeParams', 'authService', 'store', 'userService', 'cardService',
        function($scope, $location, $routeParams, authService, store, userService, cardService) {

            //discount by "enter online" method to 5.75%
            $scope.ENTER_ONLINE_DISCOUNT = 0.0575;


            // if (!authService.isAuthenticated()) {
            //     window.location = '/';
            // } else {
            //     $scope.user = store.get('user');
            // }
            $scope.user = store.get('user');

            // if the $scope.user found
            if ($scope.user) {
                if ($scope.user.role === 'dealer') {
                    $scope.isDealer = true;
                    $scope.dealerCode = $scope.user.dealer_code;
                } else {
                    $scope.isDealer = false;
                }
            } else {
                $scope.isDealer = false;
            }





            if (!store.get('selling_cards')) {

                var allCards = [];
                $scope.stores = store.get('selling_stores');
                for (var i = 0; i < $scope.stores.length; i = i + 1) {
                    var currentStore = $scope.stores[i];

                    var less;
                    if (currentStore.payBy === 'mail') {
                        less = 1 - 0;
                    } else {
                        // 5.75% less
                        less = 1 - $scope.ENTER_ONLINE_DISCOUNT;
                    }

                    console.log('current store', currentStore);
                    for (var j = 0; j < currentStore.amount; j = j + 1) {
                        var val = currentStore.gogo_buy * currentStore.value / 100;
                        var card = {
                            gogo_buy: currentStore.gogo_buy,
                            store_name: currentStore.originalName,
                            store_id: currentStore.id,
                            value: currentStore.value,
                            amount: 1,
                            pay_by: currentStore.payBy,
                            bought_value: val * less,
                            payout: (val * less) / currentStore.value * 100,
                            retailer_id: currentStore.retailer_id
                        };

                        allCards.push(card);
                    }
                }
                $scope.allSellingCards = allCards;
            } else {
                $scope.allSellingCards = store.get('selling_cards');
            }


            if ($scope.isDealer === true) {
                if (($scope.user.dealer_code === null) || ($scope.user.dealer_code === undefined) || ($scope.user.dealer_code === '')) {
                    swal({
                        title: 'Dealer Code Missing!',
                        text: 'Missing Delear code for your dealer account. Please contact admin to get the code. <a href="mailto:admin@cardslyce.com?Subject=Need%20A%20Dealer%20Code" target="_top">Request A Dealer Code Now!</a>',
                        type: 'error',
                        showCancelButton: false,
                        confirmButtonText: 'Ok',
                        closeOnConfirm: false,
                        closeOnCancel: false,
                        animation: 'slide-from-top',
                        html: true
                    });
                }
            }

            // check cards statuses
            for (var k = 0; k < $scope.allSellingCards.length; k = k + 1) {
                $scope.allSellingCards[k].status = 'unchecked';
            }

            console.log('selling stores xxx', store.get('selling_cards'));
            $scope.goBack = function() {

                $location.url('');
            };

            $scope.goNext = function() {
                console.log('current selling cards', $scope.allSellingCards);


                // check dealer code only
                if ($scope.isDealer === true) {
                    var checkDealerCode = false;
                    for (var i = 0; i < $scope.allSellingCards.length; i = i + 1) {
                        if ($scope.allSellingCards[i].dealer_code !== $scope.user.dealer_code) {
                            checkDealerCode = true;
                        }
                    }
                    if ((checkDealerCode === true) && ($scope.isDealer === true)) {
                        swal({
                            title: 'Dealer Code Not Match!',
                            text: 'Dealer Code does not match. Please contact admin to get the code. <a href="mailto:admin@cardslyce.com?Subject=Need%20A%20Dealer%20Code" target="_top">Request A Dealer Code Now!</a>',
                            type: 'error',
                            showCancelButton: false,
                            confirmButtonText: 'Ok',
                            closeOnConfirm: false,
                            closeOnCancel: false,
                            animation: 'slide-from-top',
                            html: true
                        });
                        return;
                    }
                }


                store.set('selling_cards', angular.copy($scope.allSellingCards));

                var forwardUrl = btoa(window.location.origin + '/sell-cards/#/customer-info');
                var loginURL = '/login/#/?forward_url=' + forwardUrl;

                // if user has not loggined yet
                if (!store.get('user')) {
                    swal({
                        title: 'Notice',
                        text: 'You can login before going to the next step <a href="' + loginURL + '">LOGIN NOW</a>  </br> Or you can continue to use the site as a guest',
                        type: 'warning',
                        showCancelButton: true,
                        confirmButtonText: 'Continue as guest',
                        closeOnConfirm: false,
                        confirmButtonColor: '#08C',
                        html: true
                    }, function() {
                        window.location = window.location.origin + '/sell-cards/#/customer-info?guest=true';
                        swal.close();
                    });
                } else {
                    window.location = window.location.origin + '/sell-cards/#/customer-info';
                }
            };


            // var checkCard = function(i) {
            //     var cardDat = {
            //         'card_number': $scope.allSellingCards[i].number,
            //         'retailer_id': '114',
            //         'pin': $scope.allSellingCards[i].pin
            //     };
            //     var index = i;
            //     $scope.allSellingCards[index].status = 'processing';
            //     cardService.inquiry(cardDat, function(result) {
            //         console.log(result);

            //         if (result.response.responseCode === '000') {
            //             $scope.allSellingCards[index].status = 'success';
            //         } else {
            //             if (result.response.responseCode === '010') {
            //                 $scope.allSellingCards[index].status = 'delayed';
            //             } else {
            //                 if (result.response.responseCode === '900011') {
            //                     $scope.allSellingCards[index].status = 'invalid_retailer';
            //                 } else {
            //                     if (result.response.responseCode === '179') {
            //                         $scope.allSellingCards[index].status = 'timeout';
            //                     } else {
            //                         $scope.allSellingCards[index].status = 'error';
            //                     }
            //                 }

            //             }
            //         }
            //     });
            // };

            // $scope.checkCards = function() {

            //     console.log('call check cards');
            //     for (var i = 0; i < $scope.allSellingCards.length; i = i + 1) {
            //         if (($scope.allSellingCards[i].pin) && ($scope.allSellingCards[i].number)) {
            //             // testing card inquiry
            //             checkCard(i);
            //         }
            //     }

            // };


        }
    ]);
};
},{}],40:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('SellCardCustomerInfoController', ['$scope', '$location', '$routeParams', 'authService', 'store', 'userService', 'utilService', 'storeList',
        function($scope, $location, $routeParams, authService, store, userService, utilService, storeList) {

            var guest;

            var cards;



            //discount by "enter online" method to 5.75%
            $scope.ENTER_ONLINE_DISCOUNT = 0.0575;

            if ($routeParams.guest === 'true') {
                $scope.isGuest = true;
                guest = {
                    id: 0
                };
            } else {
                $scope.isGuest = false;
            }


            $scope.user = store.get('user');

            // if the $scope.user found
            if ($scope.user) {
                if ($scope.user.role === 'dealer') {
                    $scope.isDealer = true;
                } else {
                    $scope.isDealer = false;
                }
            } else {
                $scope.isDealer = false;
            }



            cards = store.get('selling_cards');

            // to check the number of cards remaining we can add
            // to the inventory
            var availAmounts = {};
            for (var i = 0; i < storeList.length; i = i + 1) {
                availAmounts[storeList[i].id] = storeList[i].limit - storeList[i].inventory;
            }
            // console.log('Availe amount', availAmounts);


            // check if the selling has pending cards 
            $scope.hasPendingCards = false;
            $scope.hasValidCards = false;
            for (i = 0; i < cards.length; i = i + 1) {

                // Set pending receipts for mail option
                if (cards[i].pay_by === 'mail') {
                    cards[i].status = 'pending';
                    $scope.hasPendingCards = true;
                } else {
                    if (availAmounts[cards[i].store_id] > 0) {
                        cards[i].status = 'ok';
                        availAmounts[cards[i].store_id] -= 1;
                        $scope.hasValidCards = true;
                    } else {
                        cards[i].status = 'pending';
                        $scope.hasPendingCards = true;
                    }
                }


            }


            var validCards = [];
            var pendingCards = [];
            for (i = 0; i < cards.length; i = i + 1) {
                if (cards[i].status === 'ok') {
                    validCards.push(cards[i]);
                }

                if (cards[i].status === 'pending') {
                    pendingCards.push(cards[i]);
                }
            }


            $scope.sellingCards = {
                billingUser: ($scope.isGuest) ? guest : store.get('user'),
                cards: []
            };
            if ($scope.hasValidCards === true) {
                // init selling cards
                $scope.sellingCards = {
                    billingUser: ($scope.isGuest) ? guest : store.get('user'),
                    cards: validCards
                };

                console.log('selling cards', $scope.sellingCards);

                if ($scope.sellingCards.cards[0].pay_by === 'mail') {
                    $scope.subtractAmount = 0;
                } else {
                    $scope.subtractAmount = 5;
                }


                console.log('PAYBY:', $scope.sellingCards.cards[0].pay_by);
                // console.log('store limit', storeList);
                $scope.total = ($scope.sellingCards.cards[0].pay_by === 'mail') ? utilService.totalOfferMailCard($scope.sellingCards.cards) : utilService.totalOfferOnline($scope.sellingCards.cards);
                $scope.totalFaceValue = utilService.totalFaceValue($scope.sellingCards.cards);
                $scope.averagePayout = $scope.total / $scope.totalFaceValue * 100;
            }



            if ($scope.hasPendingCards === true) {
                // init pending cards 
                $scope.pendingCards = {
                    billingUser: ($scope.isGuest) ? guest : store.get('user'),
                    cards: pendingCards
                };
                if ($scope.pendingCards.cards[0].pay_by === 'mail') {
                    $scope.subtractAmount = 0;
                } else {
                    $scope.subtractAmount = 5;
                }
                $scope.pendingTotal = ($scope.pendingCards.cards[0].pay_by === 'mail') ? utilService.totalOfferMailCard($scope.pendingCards.cards) : utilService.totalOfferOnline($scope.pendingCards.cards);
                $scope.pendingTotalFaceValue = utilService.totalFaceValue($scope.pendingCards.cards);
                $scope.pendingAveragePayout = $scope.pendingTotal / $scope.pendingTotalFaceValue * 100;


            }

            // check if the credit cards is available
            if (!$scope.isGuest) {
                var tempUser = store.get('user');
                if ((tempUser.card_number !== null) &&
                    (tempUser.card_name !== null) &&
                    (tempUser.card_exp_month !== null) &&
                    (tempUser.card_exp_year !== null) &&
                    (tempUser.card_cvc !== null)
                ) {
                    $scope.emptyCC = false;
                } else {
                    $scope.emptyCC = true;
                }
            }


            $scope.isLoading = false;

            $scope.sellCards = function(paymentForm) {



                var user, billingUser, store_list, i;

                if ($scope.agreed === false) {
                    swal('Warning', 'You have to agree the terms and conditions', 'warnning');
                    return;
                }

                if ($scope.isGuest) {
                    if (paymentForm.cardNumber.$valid === false) {
                        swal('Error', 'The card number is not valid', 'error');
                        return;
                    }
                }


                if ($scope.hasValidCards === true) {
                    user = ($scope.isGuest) ? guest : store.get('user');
                    billingUser = $scope.sellingCards.billingUser;
                    if ($scope.isGuest === true) {
                        if (billingUser.email !== billingUser.email2) {
                            swal('Error!', 'Email does not match', 'error');
                            return;
                        }

                        if (billingUser.password !== billingUser.password2) {
                            swal('Error!', 'Password does not match', 'error');
                            return;
                        }

                        billingUser.username = billingUser.first_name + ' ' + billingUser.last_name;
                    }

                    // find store list
                    store_list = [];
                    for (i = 0; i < $scope.sellingCards.cards.length; i = i + 1) {
                        var currentCard = $scope.sellingCards.cards[i];
                        // console.log('card', card);


                        if (store_list.indexOf(currentCard.store_name) === -1) {
                            store_list.push(currentCard.store_name);
                        }
                    }

                    var selling_cards = {
                        user_id: user.id,
                        billing_user: ($scope.isGuest) ? billingUser : store.get('user'),
                        cards: $scope.sellingCards.cards,
                        total_amount: $scope.total,
                        total_cards: $scope.sellingCards.cards.length,
                        total_face_value: $scope.totalFaceValue,
                        average_payout: $scope.averagePayout,
                        store_list: store_list.join(','),
                        payment: $scope.sellingCards.cards[0].pay_by,
                        status: 'ok'
                    };



                    console.log('YOUR SELLING CARDS', selling_cards);

                    swal({
                        title: 'Notice',
                        text: 'The amount maybe be changed because we will verify the card balance. Please see the email verification',
                        type: 'info',
                        showCancelButton: true,
                        confirmButtonText: 'I agree',
                        closeOnConfirm: false,
                        confirmButtonColor: '#08C',
                        html: true
                    }, function() {

                        swal.close();
                        $scope.isLoading = true;
                        $scope.$apply();
                        userService.sellCards(selling_cards, function(result) {

                            console.log(result);

                            store.set('selling_cards', []);
                            store.set('selling_stores', []);


                            if ($scope.isGuest) {
                                $location.url('receipt/' + result.id + '?guest=true');
                            } else {
                                $location.url('receipt/' + result.id);
                            }

                            console.log('RECEIPT', result);
                        }, function(err) {
                            console.log('ERRR', err);
                            window.location = '/payment-declined';
                            // swal('Error', err.data.message, 'error');
                        });

                    });


                }




                // save pending cards
                if ($scope.hasPendingCards === true) {
                    user = ($scope.isGuest) ? guest : store.get('user');
                    billingUser = $scope.sellingCards.billingUser;
                    if ($scope.isGuest === true) {
                        if (billingUser.email !== billingUser.email2) {
                            swal('Error!', 'Email does not match', 'error');
                            return;
                        }

                        if (billingUser.password !== billingUser.password2) {
                            swal('Error!', 'Password does not match', 'error');
                            return;
                        }

                        billingUser.username = billingUser.first_name + ' ' + billingUser.last_name;
                    }
                    // find store list
                    store_list = [];
                    for (i = 0; i < $scope.pendingCards.cards.length; i = i + 1) {
                        var card = $scope.pendingCards.cards[i];
                        // console.log('card', card);


                        if (store_list.indexOf(card.store_name) === -1) {
                            store_list.push(card.store_name);
                        }
                    }


                    var my_pending_cards = {
                        user_id: user.id,
                        billing_user: ($scope.isGuest) ? billingUser : store.get('user'), // get billingUser from selling cards
                        cards: $scope.pendingCards.cards,
                        total_amount: $scope.pendingTotal,
                        total_cards: $scope.pendingCards.cards.length,
                        total_face_value: $scope.pendingTotalFaceValue,
                        average_payout: $scope.pendingAveragePayout,
                        store_list: store_list.join(','),
                        payment: $scope.pendingCards.cards[0].pay_by,
                        status: 'pending'
                    };



                    console.log('YOUR PENDING CARDS', my_pending_cards);

                    swal({
                        title: 'Notice',
                        text: 'The amount will be changed because we will verify the card balance. Please see the email verification',
                        type: 'info',
                        showCancelButton: true,
                        confirmButtonText: 'I agree',
                        closeOnConfirm: false,
                        confirmButtonColor: '#08C',
                        html: true
                    }, function() {

                        swal.close();
                        $scope.isLoading = true;
                        $scope.$apply();

                        userService.sellCards(my_pending_cards, function(result) {
                            console.log(result);
                            console.log('PENDING RECEIPT', result);

                            // only redirect when valid cards are not found
                            if ($scope.hasValidCards === false) {
                                store.set('selling_cards', []);
                                store.set('selling_stores', []);
                                if ($scope.isGuest) {
                                    $location.url('receipt/' + result.id + '?guest=true');
                                } else {
                                    $location.url('receipt/' + result.id);
                                }
                            }
                        }, function(err) {
                            // console.log("ERRR", err);
                            // swal('Error', err.data.message, 'error');
                            window.location = '/payment-declined';
                        });
                    });


                }




            };

        }
    ]);
};
},{}],41:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('SellCardReceiptController', ['$scope', '$location', '$routeParams', 'authService', 'store', 'userService', 'SellingCardList', 'utilService',
        function($scope, $location, $routeParams, authService, store, userService, SellingCardList, utilService) {

            var guest;

            if ($routeParams.guest === 'true') {
                $scope.isGuest = true;
                guest = {
                    id: 0
                };
            } else {
                $scope.isGuest = false;
            }



            $scope.sellingCards = SellingCardList;

            // console.log('elling cards', $scope.sellingCards);

            $scope.total = $scope.sellingCards.total_amount;

            $scope.totalFaceValue = $scope.sellingCards.total_face_value;

            $scope.averagePayout = $scope.sellingCards.average_payout;

            $scope.viewSellingHistory = function() {
                window.location = '/profile/#/sold-cards-history';
            };


        }
    ]);
};
},{}],42:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('SellCardController', ['$scope', '$location', '$routeParams', 'authService', 'store', 'userService', 'storeList', 'utilService',
        function($scope, $location, $routeParams, authService, store, userService, storeList, utilService) {


            //discount by "enter online" method to 5.75%
            $scope.ENTER_ONLINE_DISCOUNT = 0.0575;

            console.log('util service', utilService);
            $scope.payBy = {
                mail: true,
                online: false
            };



            // init default values
            $scope.store = {
                balance: null,
                amount: 1,
                brand: null
            };


            store.remove('selling_cards');

            // console.log('STORE LIST', storeList);

            $scope.storeSelected = undefined;
            $scope.allStores = storeList;

            for (var i = 0; i < $scope.allStores.length; i = i + 1) {
                $scope.allStores[i].originalName = $scope.allStores[i].name;
                $scope.allStores[i].name = utilService.titleCase($scope.allStores[i].name.split('-').join(' '));
            }


            $scope.$watch('payBy.mail', function() {
                if ($scope.payBy.mail === true) {
                    $scope.payBy.online = false;
                }
            });

            $scope.$watch('payBy.online', function() {
                if ($scope.payBy.online === true) {
                    $scope.payBy.mail = false;
                }
            });

            $scope.goToCardInfo = function() {
                $location.url('/card-info');
            };


            // check if there is any cards gonne sold
            if ((store.get('selling_stores') === null) || (store.get('selling_stores').length === 0)) {
                $scope.showIntruction = true;
                store.set('selling_stores', []);
            } else {
                $scope.showIntruction = false;
                $scope.stores = store.get('selling_stores');
                $scope.totalOfferMailCard = utilService.totalOfferMailCard($scope.stores);
                $scope.totalOfferOnline = utilService.totalOfferOnline($scope.stores);


                if ($scope.stores[0].payBy === 'mail') {
                    $scope.payBy.mail = true;
                    $scope.payBy.online = false;
                } else {
                    $scope.payBy.mail = false;
                    $scope.payBy.online = true;
                }
            }

            // store.set('selling_stores', []);
            console.log('SELLING STORES', store.get('selling_stores'));




            $scope.addStore = function() {

                if (!$scope.store.brand.originalName) {
                    $scope.store = {
                        balance: null,
                        amount: 1,
                        brand: null
                    };
                    swal('Invalid Store', 'The store you entered is not valid', 'error');
                    return;
                }

                if (($scope.store.balance === undefined) || ($scope.store.balance === null)) {
                    swal('Invalid Balance', 'Please enter the card balance', 'error');
                    return;
                }

                if (($scope.store.amount === undefined) || ($scope.store.amount === null)) {
                    swal('Invalid Quantity', 'Please enter the quantity number', 'error');
                    return;
                }

                // if ($scope.store.amount + $scope.store.brand.inventory > $scope.store.brand.store_limit) {
                //     var errMsg = 'The amount exceeds the limit ' + $scope.store.brand.store_limit + ' cards for the store: ' + $scope.store.brand.name;
                //     swal('Invalid Quantity', errMsg, 'error');
                //     return;
                // }

                // remove selling_cards saving
                store.remove('selling_cards');
                console.log('store', $scope.store);
                $scope.showIntruction = false;

                var stores = store.get('selling_stores');
                var currentStore = {
                    value: parseInt($scope.store.balance),
                    amount: parseInt($scope.store.amount),
                    gogo_buy: $scope.store.brand.gogo_buy,
                    name: $scope.store.brand.name,
                    originalName: $scope.store.brand.originalName,
                    id: $scope.store.brand.id,
                    payBy: ($scope.payBy.mail === true) ? 'mail' : 'online',
                    retailer_id: $scope.store.brand.retailer_id
                };

                $scope.store = {
                    balance: null,
                    amount: 1,
                    brand: null
                };

                stores.push(currentStore);


                $scope.totalOfferMailCard = utilService.totalOfferMailCard(stores);
                $scope.totalOfferOnline = utilService.totalOfferOnline(stores);

                $scope.stores = stores;
                store.set('selling_stores', stores);

                console.log('current store', currentStore);
            };

            $scope.removeStore = function(index) {
                store.remove('selling_cards');
                $scope.stores.splice(index, 1);
                store.set('selling_stores', $scope.stores);
                $scope.totalOfferMailCard = utilService.totalOfferMailCard($scope.stores);
                $scope.totalOfferOnline = utilService.totalOfferOnline($scope.stores);
            };

            $scope.mailBoxCLick = function() {
                if ($scope.payBy.mail === false) {
                    $scope.payBy.mail = !$scope.payBy.mail;
                    var currentStores = store.get('selling_stores');
                    for (var i = 0; i < currentStores.length; i = i + 1) {
                        currentStores[i].payBy = 'mail';
                    }

                    store.set('selling_stores', currentStores);
                }
            };

            $scope.onlineBoxCLick = function() {
                if ($scope.payBy.online === false) {
                    $scope.payBy.online = !$scope.payBy.online;

                    var currentStores = store.get('selling_stores');
                    for (var i = 0; i < currentStores.length; i = i + 1) {
                        currentStores[i].payBy = 'online';
                    }
                    store.set('selling_stores', currentStores);
                }
            };


        }
    ]);
};
},{}],43:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.controller('ShoppingCartController', ['$scope', '$location', '$routeParams', 'authService', 'store', '$rootScope',
        function($scope, $location, $routeParams, authService, store, $rootScope) {

            var getTotal = function(cards) {
                var total = 0;
                for (var i = cards.length - 1; i >= 0; i = i - 1) {
                    total += cards[i].pay;
                }
                // return total;

                return Math.round(total * 100) / 100;
            };

            $scope.selectedCards = store.get('cart');

            var total = 0;
            for (var i = $scope.selectedCards.length - 1; i >= 0; i = i - 1) {
                total += $scope.selectedCards[i].pay;
            }
            $scope.total = Math.round(total * 100) / 100;

            $scope.checkout = function() {


                var forwardUrl = btoa(window.location.origin + '/checkout');
                var loginURL = '/login/#/?forward_url=' + forwardUrl;

                // if user has not loggined yet
                if (!store.get('user')) {
                    swal({
                        title: 'Notice',
                        text: 'You can login before going to the next step <a href="' + loginURL + '">LOGIN NOW</a>  </br> Or you can continue to use the site as a guest',
                        type: 'warning',
                        showCancelButton: true,
                        confirmButtonText: 'Continue as guest',
                        closeOnConfirm: false,
                        confirmButtonColor: '#08C',
                        html: true
                    }, function() {
                        window.location = window.location.origin + '/checkout/#/?guest=true';
                        swal.close();
                    });
                } else {
                    window.location = '/checkout';
                }

            };

            $scope.removeCard = function(index) {
                var cards = store.get('cart');
                cards.splice(index, 1);

                store.set('cart', cards);
                $scope.selectedCards = store.get('cart');

                $scope.total = getTotal($scope.selectedCards);

                $rootScope.$broadcast('CHANGE_CART');

            };

        }
    ]);

};
},{}],44:[function(require,module,exports){
'use strict';

module.exports = function(m) {
    m.controller('StoreDetailController', ['$scope', '$routeParams', '$location', 'authService', 'userService', 'SweetAlert', 'store', 'storeService', '$rootScope', 'cardList',
        function($scope, $routeParams, $location, authService, userService, SweetAlert, store, storeService, $rootScope, cardList) {

            $scope.oneAtATime = false;

            $scope.storeName = $routeParams.id;

            // console.log('CARD LISGT', cardList);

            $scope.priceRange = {
                from: 0,
                to: 20
            };

            // $scope.maxPrice = 120;

            $scope.cards = cardList;

            var minD, maxD;
            if ($scope.cards.length > 0) {
                minD = 10000000000;
                maxD = 0;
            } else {
                minD = 0;
                maxD = 100;
            }

            angular.forEach($scope.cards, function(s) {

                // console.log(s);
                if (minD > s.value) {
                    minD = s.value;
                }

                if (maxD < s.value) {
                    maxD = s.value;
                }
            });


            var minValue = parseInt(minD);
            var maxValue = parseInt(maxD);

            if (minValue === maxValue) {
                maxValue = minValue + 1;
            }

            // console.log('SCOPE', $scope);

            $scope.priceRange = {
                from: minValue,
                to: maxValue
            };

            $scope.maxPrice = maxValue;
            $scope.minPrice = minValue;

            console.log('max value', $scope.maxPrice);
            console.log('min value', $scope.minPrice);

            // $scope.maxPrice = maxValue;
            // 
            // 
            // check if card has been added
            var currentCart = store.get('cart');

            if (currentCart !== null) {
                for (var j = 0; j < $scope.cards.length; j = j + 1) {
                    for (var i = 0; i < currentCart.length; i = i + 1) {
                        console.log($scope.cards[j].id, currentCart[i].id);
                        if ($scope.cards[j].id === currentCart[i].id) {
                            $scope.cards[j].isAdded = true;
                        }

                    }
                }
            }



            $scope.addToCart = function(card, index) {
                console.log('Add new item to cart', card);



                var currentCart = store.get('cart');

                // console.log("BEFORE", currentCart);
                if (currentCart) {

                    // check if the card is duplicated
                    var exist = false;
                    for (var i = currentCart.length - 1; i >= 0; i = i - 1) {
                        if (currentCart[i].id === card.id) {
                            exist = true;
                        }
                    }
                    if (exist === false) {
                        $scope.cards[index].isAdded = true;
                        currentCart.push(angular.copy(card));
                        // console.log("current card", currentCart);
                        store.set('cart', currentCart);
                        $rootScope.$broadcast('CHANGE_CART', card);
                    }

                } else {

                    store.set('cart', [angular.copy(card)]);
                    $rootScope.$broadcast('CHANGE_CART', card);
                }

                // adding effect
                var cart = $('.shopping-cart');
                var effectClasses = 'animated tada';
                var imgtodrag = $('img.card_' + card.id);


                cart.removeClass(effectClasses);
                if (imgtodrag) {
                    var imgclone = imgtodrag.clone()
                        .offset({
                            top: imgtodrag.offset().top,
                            left: imgtodrag.offset().left
                        })
                        .css({
                            'opacity': '0.5',
                            'position': 'absolute',
                            'height': '60px',
                            'width': '100px',
                            'z-index': '2000'
                        })
                        .appendTo($('body'))
                        .animate({
                            'top': cart.offset().top + 10,
                            'left': cart.offset().left + 10,
                            'width': 50,
                            'height': 30
                        }, 1000, 'easeInOutExpo');

                    setTimeout(function() {
                        cart.addClass(effectClasses);
                    }, 1500);

                    imgclone.animate({
                        'width': 0,
                        'height': 0
                    }, function() {
                        $(this).detach();
                    });
                }

            };






        }
    ]);

};
},{}],45:[function(require,module,exports){
'use strict';
module.exports = function(m) {
    m.controller('StoreListController', ['$scope', '$location', '$routeParams', 'authService', 'storeService', 'storeList',

        function($scope, $location, $routeParams, authService, storeService, storeList) {

            $scope.oneAtATime = false;

            $scope.bCount = 0;
            $scope.cCount = 0;
            $scope.eCount = 0;
            $scope.fCount = 0;
            $scope.hCount = 0;

            $scope.totalStores = 0;


            $scope.stores = storeList;

            // min max discount
            var minD = 100;
            var maxD = 0;
            angular.forEach($scope.stores, function(s) {
                if (s.category === 'B') {
                    $scope.bCount += 1;
                }
                if (s.category === 'C') {
                    $scope.cCount += 1;
                }
                if (s.category === 'E') {
                    $scope.eCount += 1;
                }
                if (s.category === 'F') {
                    $scope.fCount += 1;
                }
                if (s.category === 'H') {
                    $scope.hCount += 1;
                }

                if (minD > s.discount) {
                    minD = s.discount;
                }

                if (maxD < s.discount) {
                    maxD = s.discount;
                }
            });

            $scope.totalStores = $scope.stores;

            var minDiscount = parseInt(minD);
            var maxDiscount = parseInt(maxD);

            // console.log('SCOPE', $scope);

            $scope.discount = {
                from: minDiscount,
                to: maxDiscount
            };


            $scope.minDiscount = minDiscount;
            $scope.maxDiscount = maxDiscount;


            $scope.categoryIncludes = [];

            $scope.includeCategory = function(category) {


                var i = $.inArray(category, $scope.categoryIncludes);
                if (i > -1) {
                    $scope.categoryIncludes.splice(i, 1);
                } else {
                    $scope.categoryIncludes.push(category);
                }


            };

            $scope.categoryFilter = function(store) {
                if ($scope.categoryIncludes.length > 0) {
                    if ($.inArray(store.category, $scope.categoryIncludes) < 0)
                        return;
                }

                return store;
            };





        }
    ]);
};
},{}],46:[function(require,module,exports){
'use strict';
var m = angular.module('ht.directives', []);


// controllers
require('./lib/route-loader')(m);




module.exports = m;
},{"./lib/route-loader":47}],47:[function(require,module,exports){
'use strict';
module.exports = function(m) {
    m.directive('routeLoader', function() {
        return {
            restrict: 'EA',
            link: function(scope, element) {
                // Store original display mode of element
                var shownType = element.css('display');

                function hideElement() {
                    element.css('display', 'none');
                }

                scope.$on('$routeChangeStart', function() {
                    element.css('display', shownType);
                });
                scope.$on('$routeChangeSuccess', hideElement);
                scope.$on('$routeChangeError', hideElement);
                // Initially element is hidden
                hideElement();
            }
        };
    });
};
},{}],48:[function(require,module,exports){
'use strict';
var m = angular.module('ht.filters', []);


// controllers
require('./lib/title-case')(m);
require('./lib/discount')(m);
require('./lib/value')(m);


module.exports = m;
},{"./lib/discount":49,"./lib/title-case":50,"./lib/value":51}],49:[function(require,module,exports){
'use strict';
module.exports = function(m) {
    m.filter('discount', function() {
        return function(stores, minD, maxD) {
            // console.log("FILTER STORE", minD, maxD);
            var filteredStores = [];

            for (var i = 0; i < stores.length; i = i + 1) {
                var store = stores[i];

                if (minD <= store.discount && store.discount <= maxD) {
                    filteredStores.push(store);
                }
            }

            return filteredStores;
        };
    });
};
},{}],50:[function(require,module,exports){
'use strict';
module.exports = function(m) {
    m.filter('titlecase', function() {
        return function(input) {
            var smallWords = /^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|vs?\.?|via)$/i;

            input = input.toLowerCase();
            return input.replace(/[A-Za-z0-9\u00C0-\u00FF]+[^\s-]*/g, function(match, index, title) {
                if (index > 0 && index + match.length !== title.length &&
                    match.search(smallWords) > -1 && title.charAt(index - 2) !== ':' &&
                    (title.charAt(index + match.length) !== ' - ' || title.charAt(index - 1) === ' - ') &&
                    title.charAt(index - 1).search(/[^\s-]/) < 0) {
                    return match.toLowerCase();
                }

                if (match.substr(1).search(/[A-Z]|\../) > -1) {
                    return match;
                }

                return match.charAt(0).toUpperCase() + match.substr(1);
            });
        };
    }).filter('storename', function() {
        return function(input) {
            if (input !== undefined) {
                return input.split('-').join(' ');
            } else {
                return '';
            }

        };
    }).filter('fullname', function() {
        return function(user) {

            if ((user.first_name !== undefined) && (user.last_name !== undefined)) {
                return user.first_name + ' ' + user.last_name;
            } else {
                return user.email;
            }

        };
    }).filter('dashboardProfile', function() {
        return function(user) {

            return '/dashboard/#/user-profile/' + user.id;

        };
    }).filter('dashboardDealerProfile', function() {
        return function(user) {

            return '/dashboard/#/dealer-profile/' + user.id;

        };
    }).filter('hiddenCC', function() {
        return function(cc) {

            if (cc) {
                var digits = cc.split('');
                var obsuredCc = [];

                for (var i = 0; i < digits.length; i = i + 1) {
                    if ((i > digits.length - 1 - 4) && (i < digits.length)) {
                        obsuredCc.push(digits[i]);
                    } else {
                        obsuredCc.push('*');
                    }
                }

                return obsuredCc.join('');
            } else {
                return 'NOT SET';
            }



        };
    });
};
},{}],51:[function(require,module,exports){
'use strict';
module.exports = function(m) {
    m.filter('cardvalue', function() {
        return function(cards, minD, maxD) {
            // console.log("FILTER STORE", minD, maxD);
            var filteredCards = [];

            for (var i = 0; i < cards.length; i = i + 1) {
                var store = cards[i];

                if (minD <= store.value && store.value <= maxD) {
                    filteredCards.push(store);
                }
            }

            return filteredCards;
        };
    });
};
},{}],52:[function(require,module,exports){
'use strict';
var m = angular.module('ht.services', []);


// factories
require('./lib/store')(m);
require('./lib/user')(m);
require('./lib/auth')(m);
require('./lib/order')(m);
require('./lib/receipts')(m);
require('./lib/selling_cards')(m);
require('./lib/utils')(m);
require('./lib/setting')(m);
require('./lib/card')(m);
require('./lib/transactions')(m);

module.exports = m;
},{"./lib/auth":53,"./lib/card":54,"./lib/order":55,"./lib/receipts":56,"./lib/selling_cards":57,"./lib/setting":58,"./lib/store":59,"./lib/transactions":60,"./lib/user":61,"./lib/utils":62}],53:[function(require,module,exports){
'use strict';


module.exports = function(m) {

    m.factory('authService', ['store', '$location', 'userService', '$modal', '$http',
        function(store, $location, userService, $modal, $http) {



            var login = function(callback) {

            };


            // 
            var logout = function(callback) {

            };

            var auth = function() {

            };

            var adminAuthenticate = function() {

                console.log('CURRENT LOGGINED USER', store.get('user'));
                if (store.get('admin')) {
                    return true;
                } else {
                    window.location = '/admin-login/#/';
                    return false;
                }
            };

            var isAuthenticated = function() {

                console.log('CURRENT LOGGINED USER', store.get('user'));
                if (store.get('user')) {
                    return true;
                } else {
                    return false;
                }
            };



            return {
                'login': login,
                'logout': logout,
                'auth': auth,
                'adminAuthenticate': adminAuthenticate,
                isAuthenticated: isAuthenticated

            };
        }
    ]);
};
},{}],54:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.factory('cardService', ['$resource',
        function($resource) {

            return $resource('/api/cards/:id', null, {
                'inquiry': {
                    method: 'POST',
                    'url': '/api/cards/inquiry'
                }

            });
        }
    ]);
};
},{}],55:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.factory('orderService', ['$resource',
        function($resource) {

            return $resource('/api/orders/:id', null, {
                'get': {
                    method: 'GET',
                    'url': '/api/orders/:id'
                },
                'query': {
                    method: 'GET',
                    isArray: true,
                    'url': '/api/orders'
                },
                'sendGiftCards': {
                    method: 'GET',
                    'url': '/api/orders/giftcards/:id'
                }

            });
        }
    ]);
};
},{}],56:[function(require,module,exports){
'use strict';

module.exports = function(m) {
    m.factory('receiptService', ['$resource',
        function($resource) {

            return $resource('/api/receipts/:id', null, {
                'get': {
                    method: 'GET',
                    'url': '/api/receipts/:id'
                },
                'putToInventory': {
                    method: 'GET',
                    'url': '/api/receipts/put-to-inventory/:id'
                }

            });
        }
    ]);
};
},{}],57:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.factory('sellingCardsService', ['$resource',
        function($resource) {

            return $resource('/api/selling_cards/:id', null, {
                'get': {
                    method: 'GET',
                    'url': '/api/selling_cards/:id'
                },
                'putToInventory': {
                    method: 'GET',
                    'url': '/api/selling_cards/put-to-inventory/:cardId/:storeId'
                }

            });
        }
    ]);
};
},{}],58:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.factory('settingService', ['$resource',
        function($resource) {

            return $resource('/api/settings/:id', null, {
                'get': {
                    method: 'GET',
                    'url': '/api/settings/:id'
                },
                'query': {
                    method: 'GET',
                    isArray: true,
                    'url': '/api/settings'
                },
                'update': {
                    method: 'PUT'
                },
            });
        }
    ]);
};
},{}],59:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.factory('storeService', ['$resource',
        function($resource) {

            return $resource('/api/stores/:id', null, {
                'update': {
                    method: 'PUT'
                },
                'featured': {
                    method: 'GET',
                    'url': '/api/stores/featured',
                    isArray: true
                },
                'highestPayout': {
                    method: 'GET',
                    'url': '/api/stores/highest-payout',
                    isArray: true
                },
                'get': {
                    method: 'GET',
                    'url': '/api/stores/:id',
                    isArray: true
                },
                'stats': {
                    method: 'GET',
                    'url': '/api/stores/stats'
                },
                'popularBought': {
                    method: 'GET',
                    'url': '/api/stores/popular-bought',
                    isArray: true
                },
                'popularSold': {
                    method: 'GET',
                    'url': '/api/stores/popular-sold',
                    isArray: true
                },
                'average': {
                    method: 'GET',
                    'url': '/api/stores/average'
                },
                'dateRanges': {
                    method: 'GET',
                    'url': '/api/stores/date-ranges'
                },
                'limits': {
                    method: 'GET',
                    'url': '/api/stores/limits',
                    isArray: true
                }
            });
        }
    ]);
};
},{}],60:[function(require,module,exports){
'use strict';

module.exports = function(m) {
    m.factory('transactionService', ['$resource',
        function($resource) {

            return $resource('/api/transactions/:id', null, {


            });
        }
    ]);
};
},{}],61:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.factory('userService', ['$resource',
        function($resource) {

            return $resource('/api/users/:id', null, {
                'update': {
                    method: 'PUT'
                },
                'login': {
                    method: 'POST',
                    'url': '/api/users/login',
                },
                'adminLogin': {
                    method: 'POST',
                    'url': '/api/users/admin-login',
                },
                'get': {
                    method: 'GET'
                },
                'dealers': {
                    method: 'GET',
                    'url': '/api/users/dealers',
                    isArray: true
                },
                'profile': {
                    method: 'GET',
                    'url': '/api/users/profile/:id'
                },
                'guestsSellingCards': {
                    method: 'GET',
                    'url': '/api/users/guests/sell_cards',
                    isArray: true
                },
                'guestsBuyingCards': {
                    method: 'GET',
                    'url': '/api/users/guests/buy_cards',
                    isArray: true
                },
                'inventory': {
                    method: 'GET',
                    'url': '/api/users/inventory',
                    isArray: true
                },
                'inventoryByRetailer': {
                    method: 'GET',
                    'url': '/api/users/inventory_by_retailer',
                    isArray: true
                },
                'cards': {
                    method: 'GET',
                    'url': '/api/users/cards',
                    isArray: true
                },
                'soldCards': {
                    method: 'GET',
                    'url': '/api/users/sold-cards',
                    isArray: true
                },
                'pendingCards': {
                    method: 'GET',
                    'url': '/api/users/pending-cards',
                    isArray: true
                },
                'forgetPassword': {
                    method: 'POST',
                    'url': '/api/users/forget-password',
                },
                'resetPassword': {
                    method: 'POST',
                    'url': '/api/users/reset-password',
                },
                'pay': {
                    method: 'POST',
                    'url': '/api/users/pay-order',
                },
                'sellCards': {
                    method: 'POST',
                    'url': '/api/users/sell-cards',
                },
                'getOrdersByUserId': {
                    method: 'GET',
                    'url': '/api/users/orders/:id',
                    isArray: true
                },
                'getSoldCardsByUserId': {
                    method: 'GET',
                    'url': '/api/users/sold-cards-list/:id',
                    isArray: true
                }
            });
        }
    ]);
};
},{}],62:[function(require,module,exports){
'use strict';


module.exports = function(m) {
    m.factory('utilService', ['$resource',
        function() {

            var totalOfferMailCard = function(card) {
                var total = 0;
                for (var i = 0; i < card.length; i = i + 1) {

                    // console.log('totalOfferMailCard', card[i]);
                    total += card[i].gogo_buy * card[i].value * card[i].amount / 100;
                }

                return total;
            };

            var totalOfferOnline = function(card) {
                var total = 0;
                for (var i = 0; i < card.length; i = i + 1) {
                    var subTotal = card[i].gogo_buy * card[i].value * card[i].amount / 100;
                    total += subTotal;
                }

                // 5.75% less
                return (1 - 0.0575) * total;
            };

            var totalFaceValue = function(cards) {
                var total = 0;
                for (var i = 0; i < cards.length; i = i + 1) {
                    total += cards[i].value;
                }

                return total;
            };

            var titleCase = function(str) {
                return str.replace(/\w\S*/g, function(txt) {
                    return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
                });
            };

            var averagePayout = function(cards) {
                var total = 0;
                for (var i = 0; i < cards.length; i = i + 1) {
                    total += cards[i].gogo_buy;
                }

                return total / cards.length;
            };

            return {
                totalOfferMailCard: totalOfferMailCard,
                totalOfferOnline: totalOfferOnline,
                titleCase: titleCase,
                totalFaceValue: totalFaceValue,
                averagePayout: averagePayout
            };
        }
    ]);
};
},{}]},{},[1]);
